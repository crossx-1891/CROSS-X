#!/bin/sh
# Define the QEMU command as a variable
QEMU_CMD='qemu-system-x86_64 \
    -m 4G \
    -nographic \
    -kernel ./bzImage \
    -append "console=ttyS0 oops=panic panic=-1 nokaslr" \
    -no-reboot \
    -cpu kvm64,smep,smap \
    -enable-kvm \
    -smp 2 \
    -monitor /dev/null \
    -initrd ./rootfs.cpio \
    -gdb tcp::12345'

# Start a new tmux session for QEMU and GDB
SESSION="kernel"
tmux new-session -d -s $SESSION && tmux send-keys "$QEMU_CMD" C-m
#tmux split-window -h && sleep 0.3 && tmux send-keys 'gdb -ex "c"' C-m
tmux attach-session -t $SESSION
